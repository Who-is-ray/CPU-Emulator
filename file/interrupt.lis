X-Makina Assembler - Version 1.18 (27 June 2018)
.ASM file: interrupt.asm

  1	    	     		dev0 		equ #$0000
  2	    	     		dev0_psw	equ #$0060	;priority of device 0 is 3, IE is set
  3	    	     		dev0_vec	equ	#$FFC0
  4	    	     		isr0_addr	equ #$FFC2	;address of ISR0
  5	    	     		dev4		equ #$0008
  6	    	     		dev4_psw	equ #$0080	;priority of device 1 is 4, IE is unset
  7	    	     		dev4_vec	equ #$FFD0
  8	    	     		isr4_addr	equ #$FFD2	;address of ISR2
  9	    	     		comp_psw	equ	#$0020	;priority of computer is 1
 10	    	     		PSW			equ	R6		;PSW is alias of R6
 11	    	     		LR			equ	R4	; LR is alias of R4
 12	    	     		SP			equ	R5	; SP is alias of R5 
 13	    	     		PC			equ	R7	; PC is alias of R7
 14	    	     		STKTOP		equ	#$FFBE	; Top-of-stack - word below device vectors
 15	    	     		org	#$500
 16	    	     	
 17	0500	9106	Start	movl comp_psw,PSW		;set computer priority equal to 1
 18	    	     		
 19	    	     		; Initialize stack point
 20	0502	95F5		movl	STKTOP,SP	; LSB to SP
 21	0504	A7FD		movh	STKTOP,SP	; MSB to SP
 22	    	     		
 23	    	     		;turn on the PSW.IE of device 1
 24	0506	9000		movl dev0,R0		
 25	0508	A000		movh dev0,R0
 26	050A	8001		ld R0,R1
 27	050C	6089		add #1,R1
 28	050E	8808		st R1,R0
 29	    	     		
 30	    	     	wait
 31	0510	3FFF		bal wait
 32	    	     			
 33	    	     		org #$2000
 34	    	     	isr0
 35	2000	9000		movl dev0,R0		;set device 1 address
 36	2002	A000		movh dev0,R0
 37	    	     		;movl dev4,R1		;set device 4 address
 38	    	     		;movh dev4,R1
 39	2004	C0C2		ldr.b	R0,#1,R2
 40	    	     		;ld.b R1,R2
 41	2006	E4D0		str.b	R2,R0,#9			;load data in dev0 to dev 4
 42	2008	7627		mov LR,PC
 43	    	     	;
 44	    	     		org #$ffc0
 45	FFC0	0060		word #$0060
 46	FFC2	2000		word isr0
 47	    	     		
 48	    	     		org #$ffd0
 49	FFD0	0080		word #$80
 50	    	     		
 51	    	     		end	Start

Successful completion of assembly

** Symbol table **
Name                               	Type	Value	Decimal
isr0                               	LBL	2000	8192
wait                               	LBL	0510	1296
Start                              	LBL	0500	1280
STKTOP                             	LBL	FFBE	-66
PC                                 	REG	0007	7
SP                                 	REG	0005	5
LR                                 	REG	0004	4
PSW                                	REG	0006	6
comp_psw                           	LBL	0020	32
isr4_addr                          	LBL	FFD2	-46
dev4_vec                           	LBL	FFD0	-48
dev4_psw                           	LBL	0080	128
dev4                               	LBL	0008	8
isr0_addr                          	LBL	FFC2	-62
dev0_vec                           	LBL	FFC0	-64
dev0_psw                           	LBL	0060	96
dev0                               	LBL	0000	0
R7                                 	REG	0007	7
R6                                 	REG	0006	6
R5                                 	REG	0005	5
R4                                 	REG	0004	4
R3                                 	REG	0003	3
R2                                 	REG	0002	2
R1                                 	REG	0001	1
R0                                 	REG	0000	0

.XME file: D:\Repos\emulator\file\interrupt.xme

